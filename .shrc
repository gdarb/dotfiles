# ~~ shell config ~~

# work out which OS we're in
OS="`uname`"
case $OS in
    'Darwin')
        # set ls to show colour
        alias ls="ls -G"

        # use the homebrew ruby & gem
        export PATH="/usr/local/opt/ruby/bin:$PATH"

        # add MacVim to $PATH to enable `mvim` / `gvim` in terminal
        # Note: added to end of $PATH as to not override Homebrew's vim
        export PATH="$PATH:/Applications/MacVim.app/Contents/bin"

        # add ssh key to ssh-agent using the built-in macOS ssh tool
        # to allow storing of the keyphrase in the macOS Keychain
        if [[ -r "$HOME/.ssh/id_rsa" ]]; then
            /usr/bin/ssh-add -qK "$HOME/.ssh/id_rsa"
        fi

        # alias for all updating of homebrew
        alias brewify="brew update; brew upgrade; brew upgrade --cask; brew cleanup"

        # opt-out of homebrew analytics
        export HOMEBREW_NO_ANALYTICS=1

        # alias for resetting launchpad order
        alias resetlaunchpad="defaults write com.apple.dock ResetLaunchPad -bool true; killall Dock"
    ;;
    'Linux')
        alias ls="ls --color=auto"
    ;;
    *)
    ;;
esac

# have GPG ask for passphrase in terminal
export GPG_TTY=$(tty)

# use a long listing format
alias ll="ls -la"

# use `config` for managing dotfiles in git
function config() {
    (cd && git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME $@)
}

# set $WORKON_HOME (just in case)
export WORKON_HOME="$HOME/.virtualenvs"

# activate virtualenvwrapper
if [[ -r /usr/local/bin/virtualenvwrapper.sh ]]; then
	export VIRTUALENVWRAPPER_PYTHON=$(which python3)
	source /usr/local/bin/virtualenvwrapper.sh
fi

# use `vivid` to set LS_COLORS
if command -v vivid &> /dev/null; then
	export LS_COLORS="$(vivid generate snazzy)"
fi

# use `bat` as MANPAGER
if command -v bat &> /dev/null; then
	export MANPAGER="sh -c 'col -bx | bat -l man -p'"
fi

# pip should only run if there is a virtualenv currently activated
export PIP_REQUIRE_VIRTUALENV=true

# use `gpip` to force installation of a package in the global python environment
gpip(){
    PIP_REQUIRE_VIRTUALENV="" pip "$@"
}

# alternative `pip3` version
gpip3(){
    PIP_REQUIRE_VIRTUALENV="" pip3 "$@"
}
